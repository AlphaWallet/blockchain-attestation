<html>
<head>
    <style>
        #log div {
            margin-bottom: 5px;
            background-color: #f5f5f5;
            padding: 5px 10px;
            white-space: normal;
            word-break: break-word;
        }
    </style>
</head>
<body>
<div id="log"></div>
    <script type="text/javascript" src="assets/js/buffer.js"></script>
<script>
    Buffer = buffer.Buffer;
    process = {env: {NODE_DEBUG: "false"}};
</script>
    <script type="text/javascript" src="dist/authenticator.js"></script>
<script>
    counter = 1;
    function writeToLog(text){
        let node = document.createElement('div');
        node.innerText = counter + ". " + text;
        log.prepend(node);
        counter++;
    }

    function uint8tohex(uint8) {
        return Array.from(uint8).map(i => ('0' + i.toString(16)).slice(-2)).join('');
    }

    function base64ToUint8array( base64str ) {
        if (typeof Buffer !== 'undefined') {
            return Uint8Array.from(Buffer.from(base64str, 'base64'));
        } else {
            return Uint8Array.from(atob(base64str), c => c.charCodeAt(0));
        }
    }

    (async ()=>{
        let attest = new Attest();
        writeToLog('prepare and sign attestRequest.');
        let secret = BigInt(12345);
        let receiverId = "test@test.com";
        let ATTESTOR_DOMAIN = "http://wwww.attestation.id"

        let attestJson = await Authenticator.requestAttest(receiverId, 0, ATTESTOR_DOMAIN, secret);

        writeToLog('attestRequest received:');

        writeToLog(attestJson);

        writeToLog('create attestation');

        let base64ticket = "MIGbMA0CAQYCBWE3ap3-AgEABEEEKJZVxMEXbkSZZBWnNUTX_5ieu8GUqf0bx_a0tBPF6QYskABaMJBYhDOXsmQt3csk_TfMZ2wdmfRkK7ePCOI2kgNHADBEAiBwLK_95NPZo0W01HDBfyZisZ2KaNrzoWuxRV-nhjGLMAIgaOP4eVVINH5xM8Cv9OVDdyOG3BxUqyPVQOuDU9PaC9o=";
        // let ticketSecret =45845870611;
        let ticketSecret =45845870684;

        writeToLog('base64ticket: ' + base64ticket);
        writeToLog('ticketSecret: ' + ticketSecret);

        let attestorPrivateKey = "-----BEGIN CHEQUE-----\n" +
            "MIICSwIBADCB7AYHKoZIzj0CATCB4AIBATAsBgcqhkjOPQEBAiEA////////////\n" +
            "/////////////////////////v///C8wRAQgAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n" +
            "AAAAAAAAAAAAAAAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHBEEE\n" +
            "eb5mfvncu6xVoGKVzocLBwKb/NstzijZWfKBWxb4F5hIOtp3JqPEZV2k+/wOEQio\n" +
            "/Re0SKaFVBmcR9CP+xDUuAIhAP////////////////////66rtzmr0igO7/SXozQ\n" +
            "NkFBAgEBBIIBVTCCAVECAQEEIIl3HJrX0OAEtiZWlqGDCOtSmpZv5o6kasujb/47\n" +
            "kGWsoIHjMIHgAgEBMCwGByqGSM49AQECIQD/////////////////////////////\n" +
            "///////+///8LzBEBCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQg\n" +
            "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcEQQR5vmZ++dy7rFWgYpXO\n" +
            "hwsHApv82y3OKNlZ8oFbFvgXmEg62ncmo8RlXaT7/A4RCKj9F7RIpoVUGZxH0I/7\n" +
            "ENS4AiEA/////////////////////rqu3OavSKA7v9JejNA2QUECAQGhRANCAATq\n" +
            "T42Iv5c4koQmBVq+qhJ3Q/VRK1gKWXNDJpJlkuFdoFekKkDYxr5ldiLZJ9+EmIr7\n" +
            "1Fl6qYxW/gX31q+jgxnQ\n" +
            "-----END CHEQUE----- ";

        // Authenticator.createAttest(attestorPrivateKey,'AlphaWallet', 60*60*1000, attestJson, ATTESTOR_DOMAIN);

        return;

        (new Authenticator()).getAuthenticationBlob({
            ticketBlob: base64ticket,
            ticketSecret: ticketSecret,
            attestationOrigin: 'https://stage.attestation.id/',
        }, useDevconTicket => {
            writeToLog('useDevconTicket received (in hex ): ' + useDevconTicket);
        });

    })()

</script>
</body>
</html>
